{% extends 'student_template/base_template.html' %}

{% block page_title %}
    Student Home
{% endblock page_title %}

{% block main_content %}

{% load static %}

<section class="p-6 bg-gray-100">
    <div class="container mx-auto">

        {% comment %} Boxes Section Starts {% endcomment %}
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
            <div class="bg-white p-4 rounded-lg shadow-md border">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-2xl font-bold">{{ total_attendance }}</h3>
                        <p>Total Attendance</p>
                    </div>
                    <div class="text-3xl">
                        <i class="ion ion-stats-bars"></i>
                    </div>
                </div>
                <a href="{% url 'student_view_attendance' %}" class="block mt-2 hover:underline">More info <i class="fas fa-arrow-circle-right"></i></a>
            </div>

            <div class="bg-white p-4 rounded-lg shadow-md border">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-2xl font-bold">{{ attendance_absent }}</h3>
                        <p>Absent</p>
                    </div>
                    <div class="text-3xl">
                        <i class="ion ion-stats-bars"></i>
                    </div>
                </div>
                <a href="{% url 'student_view_attendance' %}" class="block mt-2 hover:underline">More info <i class="fas fa-arrow-circle-right"></i></a>
            </div>

            <div class="bg-white p-4 rounded-lg shadow-md border">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-2xl font-bold">{{ attendance_present }}</h3>
                        <p>Present</p>
                    </div>
                    <div class="text-3xl">
                        <i class="ion ion-stats-bars"></i>
                    </div>
                </div>
                <a href="{% url 'student_view_attendance' %}" class="block mt-2 hover:underline">More info <i class="fas fa-arrow-circle-right"></i></a>
            </div>

            <div class="bg-white p-4 rounded-lg shadow-md border">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-2xl font-bold">{{ total_subjects }}</h3>
                        <p>Total Subjects</p>
                    </div>
                    <div class="text-3xl">
                        <i class="ion ion-pie-graph"></i>
                    </div>
                </div>
                <a href="#" class="block mt-2 hover:underline">More info <i class="fas fa-arrow-circle-right"></i></a>
            </div>
        </div>
        {% comment %} Boxes Section Ends {% endcomment %}

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6">
            <div class="bg-white p-4 rounded-lg shadow-md border">
                <h3 class="text-lg font-bold">Total Attendance Chart</h3>
                <canvas id="pieChart" class="h-64 w-full"></canvas>
            </div>

            <div class="bg-white p-4 rounded-lg shadow-md border">
                <h3 class="text-lg font-bold">Attendance Statistics by Subjects</h3>
                <canvas id="barChart" class="h-64 w-full"></canvas>
            </div>
        </div>

    </div><!-- /.container-fluid -->
</section>

{% endblock main_content %}

{% block custom_js %}
<script>
   $(document).ready(function(){
       // Code for Pie Chart
        var pieData        = {
        labels: [
            'ABSENT', 
            'PRESENT', 
        ],
        datasets: [
            {
            data: [{{ attendance_absent }}, {{ attendance_present }}],
            backgroundColor : ['#f56954', '#00a65a'],
            }
        ]
        }
       // Code for Pie Chart
        var pieChartCanvas = $('#pieChart').get(0).getContext('2d')
        var pieData        = pieData;
        var pieOptions     = {
        maintainAspectRatio : false,
        responsive : true,
        }
        // Create pie or doughnut chart
        var pieChart = new Chart(pieChartCanvas, {
        type: 'pie',
        data: pieData,
        options: pieOptions      
        })

        // Code for Bar Chart
        var subjects = {{ subject_name|safe }}
        var data_present = {{ data_present }}
        var data_absent = {{ data_absent }}

        // Dataset for Bar Chart
        var areaChartData = {
        labels  : subjects,
        datasets: [
            {
            label               : 'Present in Class',
            backgroundColor     : 'rgba(60,141,188,0.9)',
            borderColor         : 'rgba(60,141,188,0.8)',
            pointRadius          : false,
            pointColor          : '#3b8bba',
            pointStrokeColor    : 'rgba(60,141,188,1)',
            pointHighlightFill  : '#fff',
            pointHighlightStroke: 'rgba(60,141,188,1)',
            data                : data_present
            },
            {
            label               : 'Absent in Class',
            backgroundColor     : 'rgba(210, 214, 222, 1)',
            borderColor         : 'rgba(210, 214, 222, 1)',
            pointRadius         : false,
            pointColor          : 'rgba(210, 214, 222, 1)',
            pointStrokeColor    : '#c1c7d1',
            pointHighlightFill  : '#fff',
            pointHighlightStroke: 'rgba(220,220,220,1)',
            data                : data_absent
            },
        ]
        }


        var barChartCanvas = $('#barChart').get(0).getContext('2d')
        var barChartData = jQuery.extend(true, {}, areaChartData)
        var temp1 = areaChartData.datasets[0]
        barChartData.datasets[0] = temp1

        var barChartOptions = {
        responsive              : true,
        maintainAspectRatio     : false,
        datasetFill             : false
        }

        var barChart = new Chart(barChartCanvas, {
        type: 'bar', 
        data: barChartData,
        options: barChartOptions
        })


   })
</script>
{% endblock custom_js %}
